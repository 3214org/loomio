= render 'add_members', group: group
- if group.membership_requests.present? && (can? :edit, group)
  .sub-panel#user-requests
    %h3 Membership requests
    %ul.main-list#request-list
      =render :partial => 'membership_request', :collection => group.membership_requests

- unless group.hide_members && (cannot? :edit, group)
  .sub-panel
    %h3 Current members
    - if group.users_include?(current_user) || current_user.nil?
      - if group.parent && (can? :add_members, group)
        .dropdown#members
          = link_to image_tag("dropdown.png", title:'member settings', alt:'member settings'), "#", class: "dropdown-toggle", 'data-toggle' => 'dropdown'
          %ul.dropdown-menu.pull-right
            %li= link_to "Add members", "#", {"data-toggle" => "modal", href: "#invite-group-members"}

        #invite-group-members.modal.hidden
          .modal-header
            %button.close{"data-dismiss" => "modal"}Ã—
            %h3= "Select members to add to #{group.name}"
          = form_tag add_members_group_path do
            .modal-body
              - group.parent.users_sorted.each do |member|
                - unless member == current_user
                  .invite-member-checkbox-container
                    - is_member = false
                    - is_member = true if group.users_include?(member)
                    = check_box_tag "user_#{member.id}", 1, is_member, disabled: is_member
                    = label_tag "user_#{member.id}", member.name
            .modal-footer
              = submit_tag "Invite members", class: "btn btn-small"

    #membership-count.label
      = group.memberships.count

    %ul.main-list#users-list
      = render :partial => 'membership',
        :collection => group.memberships.sort { |a,b| a.user_name.downcase <=> b.user_name.downcase },
        :locals => { group: group }

